<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Management System</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Load Alpine.js -->
    <!-- 'defer' ensures our medicalApp() function is defined before Alpine tries to run -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script>
        function medicalApp() {
            return {
                loading: true,
                currentTab: 'dashboard', // Default tab is now dashboard
                tabs: [
                    // --- NEW: Dashboard Tab ---
                    { id: 'dashboard', name: 'Dashboard', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>' },
                    { id: 'patients', name: 'Patients', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>' },
                    { id: 'doctors', name: 'Doctors', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9a3 3 0 00-3-3h-1.5a3 3 0 100 6H15a3 3 0 003-3zM9 9a3 3 0 00-3-3H4.5a3 3 0 100 6H6a3 3 0 003-3zM12 15a3 3 0 00-3-3H7.5a3 3 0 100 6H9a3 3 0 003-3z"></path>' },
                    { id: 'appointments', name: 'Appointments', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>' },
                    { id: 'billing', name: 'Billing', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>' },
                    { id: 'inventory', name: 'Inventory', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>' }
                ],

                // --- Data Properties ---
                patients: [],
                doctors: [],
                appointmentSpecialty: 'All', // For appointment filter
                appointments: [],
                billing: [],
                inventory: [],

                // --- NEW: Search properties ---
                searchPatient: '',
                searchDoctor: '',
                searchAppointment: '',
                searchBilling: '',
                searchInventory: '',

                // --- MODIFIED: List of doctor specialties ---
                doctorSpecialties: [
                    'General Physician', 'Pediatrician', 'Gynecologist', 'Orthopedic Surgeon',
                    'Cardiologist', 'Dermatologist', 'ENT Specialist', 'Ophthalmologist',
                    'Neurologist', 'Psychiatrist', 'Dentist', 'Radiologist', 'Oncologist',
                    'Urologist', 'Nephrologist', 'Gastroenterologist', 'Endocrinologist',
                    'Pulmonologist', 'Physiotherapist', 'Emergency Medicine'
                ],

                modal: {
                    open: false,
                    type: '',
                    title: '',
                    isEdit: false
                },
                // --- NEW: Modal for viewing bill items ---
                billModal: {
                    open: false,
                    items: [],
                    total: 0
                },
                // --- NEW: Form for adding items to a bill ---
                billForm: {
                    itemId: '',
                    quantity: 1
                },

                form: {},

                // Schemas for clearing the form
                schemas: {
                    patients: { id: null, name: '', contact: '', history: '', dob: '', gender: 'M' },
                    doctors: { id: null, name: '', specialty: 'General Physician', schedule: '', fee: 100 },
                    // --- FIX: Set default patient/doctor to '' instead of null for 'required' validation ---
                    appointments: { id: null, patient: '', doctor: '', datetime: new Date().toISOString().slice(0, 16) },
                    billing: { id: null, patient: '', items: [], total: 0, status: 'Pending' },
                    inventory: { id:null, item: '', quantity: 0, supplier: '', price: 0.0 }
                },

                // Load all data from our Flask API
                async init() {
                    await this.fetchAllData();
                    this.loading = false;
                },

                async fetchAllData() {
                    try {
                        // Add cache-busting query parameter
                        const cacheBust = `?_=${new Date().getTime()}`;
                        const [patients, doctors, appointments, billing, inventory] = await Promise.all([
                            fetch(`/api/patients${cacheBust}`).then(res => res.json()),
                            fetch(`/api/doctors${cacheBust}`).then(res => res.json()),
                            fetch(`/api/appointments${cacheBust}`).then(res => res.json()),
                            fetch(`/api/billing${cacheBust}`).then(res => res.json()),
                            fetch(`/api/inventory${cacheBust}`).then(res => res.json())
                        ]);
                        this.patients = patients;
                        this.doctors = doctors;
                        this.appointments = appointments;
                        this.billing = billing;
                        this.inventory = inventory;
                    } catch (error) {
                        console.error("Error fetching data:", error);
                        alert("Could not load data from the server.");
                    }
                },

                // Fetch data for a specific type
                async fetchData(type) {
                    try {
                        const cacheBust = `?_=${new Date().getTime()}`;
                        const response = await fetch(`/api/${type}${cacheBust}`);
                        const newData = await response.json();

                        if (type === 'patients') this.patients = newData;
                        else if (type === 'doctors') this.doctors = newData;
                        else if (type === 'appointments') this.appointments = newData;
                        else if (type === 'billing') this.billing = newData;
                        else if (type === 'inventory') this.inventory = newData;

                    } catch (error) {
                        console.error(`Error fetching ${type}:`, error);
                    }
                },

                // --- NEW: Computed properties for search filtering ---
                get filteredPatients() {
                    if (!this.searchPatient) return this.patients;
                    const search = this.searchPatient.toLowerCase();
                    return this.patients.filter(p =>
                        p.name.toLowerCase().includes(search) ||
                        (p.contact && p.contact.toLowerCase().includes(search)) ||
                        (p.gender && p.gender.toLowerCase() === search)
                    );
                },
                get filteredDoctors() {
                    if (!this.searchDoctor) return this.doctors;
                    const search = this.searchDoctor.toLowerCase();
                    return this.doctors.filter(d =>
                        d.name.toLowerCase().includes(search) ||
                        d.specialty.toLowerCase().includes(search)
                    );
                },
                get filteredAppointments() {
                    if (!this.searchAppointment) return this.appointments;
                    const search = this.searchAppointment.toLowerCase();
                    return this.appointments.filter(a =>
                        this.getPatientName(a.patient).toLowerCase().includes(search) ||
                        this.getDoctorName(a.doctor).toLowerCase().includes(search)
                    );
                },
                get filteredBilling() {
                    if (!this.searchBilling) return this.billing;
                    const search = this.searchBilling.toLowerCase();
                    return this.billing.filter(b =>
                        this.getPatientName(b.patient).toLowerCase().includes(search) ||
                        b.status.toLowerCase().includes(search)
                    );
                },
                // --- NEW: Computed property to filter doctors for the appointment modal ---
                get filteredDoctorsForAppointment() {
                    if (this.appointmentSpecialty === 'All') {
                        return this.doctors;
                    }
                    return this.doctors.filter(d =>
                        d.specialty === this.appointmentSpecialty
                    );
                },
                get filteredInventory() {
                    if (!this.searchInventory) return this.inventory;
                    const search = this.searchInventory.toLowerCase();
                    return this.inventory.filter(i =>
                        i.item.toLowerCase().includes(search) ||
                        (i.supplier && i.supplier.toLowerCase().includes(search))
                    );
                },

                // --- NEW: Dashboard computed properties ---
                get todaysAppointments() {
                    const today = new Date().setHours(0, 0, 0, 0);
                    return this.appointments.filter(appt => {
                        const apptDate = new Date(appt.datetime).setHours(0, 0, 0, 0);
                        return apptDate === today;
                    });
                },
                get pendingBillCount() {
                    return this.billing.filter(bill => bill.status === 'Pending').length;
                },
                get lowStockItems() {
                    return this.inventory.filter(item => item.quantity <= 10);
                },


                // Open the add/edit modal
                openModal(type, item = null) {
                    this.modal.type = type;
                    if (item) {
                        // Edit mode
                        this.modal.isEdit = true;
                        this.modal.title = `Edit ${type.slice(0, -1)}`;
                        // Clone item data to form
                        this.form = { ...item };
                        // Special handling for appointment datetime
                        if(type === 'appointments' && this.form.datetime) {
                            this.form.datetime = this.formatISODate(this.form.datetime);
                        }
                        // Set specialty when editing an appointment
                        if (type === 'appointments' && this.form.doctor) {
                            this.appointmentSpecialty = this.getDoctorSpecialty(this.form.doctor);
                        }
                    } else {
                        // Add mode
                        this.modal.isEdit = false;
                        this.modal.title = `Add ${type.slice(0, -1)}`;
                        // Use schema to reset form
                        this.form = { ...this.schemas[type] };
                        // Ensure 'items' array is fresh for new bill
                        if (type === 'billing') {
                            this.form.items = [];
                            this.form.patient = ''; // FIX: set default patient to ''
                        } else if (type === 'appointments') {
                            this.appointmentSpecialty = 'All'; // Reset specialty filter
                        }
                    }
                    this.modal.open = true;
                },

                // Handle form submission (Add or Edit)
                async submitForm() {
                    const type = this.modal.type;
                    const url = this.modal.isEdit ? `/api/${type}/${this.form.id}` : `/api/${type}`;
                    const method = this.modal.isEdit ? 'PUT' : 'POST';

                    try {
                        const response = await fetch(url, {
                            method: method,
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.form)
                        });

                        if (!response.ok) throw new Error('Server responded with an error');

                        // --- MODIFIED: Handle auto-billing for appointments ---
                        if (type === 'appointments' && !this.modal.isEdit) {
                            // This was a new appointment, let's create a bill
                            const apptData = await response.json(); // Get the new appt ID
                            await this.autoCreateBill(this.form.patient, this.form.doctor);
                            await this.fetchData('billing'); // Refresh billing data
                        }

                        // Refresh data for the current tab and close modal
                        await this.fetchData(type);
                        this.modal.open = false;

                    } catch (error) {
                        console.error("Error submitting form:", error);
                        alert(`Could not save ${this.modal.type}. Please try again.`);
                    }
                },

                // --- NEW: Auto-create bill after appointment ---
                async autoCreateBill(patientId, doctorId) {
                    const doctor = this.doctors.find(d => d.id === doctorId);
                    if (!doctor || !doctor.fee) {
                        console.warn("Doctor has no fee, no bill created.");
                        return;
                    }

                    const newBill = {
                        patient: patientId,
                        items: [{
                            id: 'consult_fee', // Special ID for consultation
                            name: `Consultation with ${doctor.name}`,
                            price: doctor.fee,
                            quantity: 1
                        }],
                        total: doctor.fee,
                        status: 'Pending'
                    };

                    try {
                        await fetch('/api/billing', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newBill)
                        });
                    } catch (error) {
                        console.error("Error auto-creating bill:", error);
                    }
                },

                // Delete an item
                async deleteItem(type, id) {
                    if (!confirm(`Are you sure you want to delete this ${type.slice(0, -1)}?`)) return;

                    try {
                        const response = await fetch(`/api/${type}/${id}`, {
                            method: 'DELETE'
                        });
                        if (!response.ok) throw new Error('Server responded with an error');

                        await this.fetchData(type);
                    } catch (error) {
                        console.error("Error deleting item:", error);
                        alert(`Could not delete ${this.modal.type}. Please try again.`);
                    }
                },

                // --- NEW: Add item to the bill in the modal ---
                addItemToBill() {
                    const item = this.inventory.find(i => i.id === this.billForm.itemId);
                    if (!item || this.billForm.quantity <= 0) {
                        alert("Please select a valid item and quantity.");
                        return;
                    }

                    if (this.billForm.quantity > item.quantity) {
                        alert(`Not enough stock. Only ${item.quantity} available.`);
                        return;
                    }

                    // Check if item is already in the bill
                    const existingItem = this.form.items.find(i => i.id === item.id);
                    if (existingItem) {
                        existingItem.quantity += this.billForm.quantity;
                    } else {
                        this.form.items.push({
                            id: item.id,
                            name: item.item,
                            price: item.price,
                            quantity: this.billForm.quantity
                        });
                    }

                    this.calculateBillTotal();
                    this.billForm.itemId = '';
                    this.billForm.quantity = 1;
                },

                // --- NEW: Remove item from bill in the modal ---
                removeItemFromBill(itemId) {
                    this.form.items = this.form.items.filter(i => i.id !== itemId);
                    this.calculateBillTotal();
                },

                // --- NEW: Calculate bill total ---
                calculateBillTotal() {
                    this.form.total = this.form.items.reduce((sum, item) => {
                        return sum + (item.price * item.quantity);
                    }, 0);
                },

                // --- NEW: Mark a bill as paid ---
                async markAsPaid(billId) {
                    if (!confirm("This will mark the bill as paid and update inventory stock. Are you sure?")) return;

                    try {
                        const response = await fetch(`/api/billing/pay/${billId}`, {
                            method: 'POST'
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Server responded with an error');
                        }

                        // Refresh both billing and inventory data
                        await this.fetchData('billing');
                        await this.fetchData('inventory');
                    } catch (error) {
                        console.error("Error marking bill as paid:", error);
                        alert(`Could not process payment: ${error.message}`);
                    }
                },

                // --- NEW: Show items on a bill ---
                showBillItems(bill) {
                    this.billModal.items = bill.items;
                    this.billModal.total = bill.total;
                    this.billModal.open = true;
                },

                // --- NEW: Helper to calculate age from DOB ---
                calculateAge(dobString) {
                    if (!dobString) return 'N/A';
                    try {
                        const birthDate = new Date(dobString);
                        const today = new Date();
                        let age = today.getFullYear() - birthDate.getFullYear();
                        const m = today.getMonth() - birthDate.getMonth();
                        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }
                        return age;
                    } catch (e) {
                        return 'N/A';
                    }
                },

                // Helper to format date for display
                formatDateTime(isoString) {
                    if (!isoString) return 'N/A';
                    try {
                        const date = new Date(isoString);
                        return date.toLocaleString('en-US', {
                            dateStyle: 'medium',
                            timeStyle: 'short'
                        });
                    } catch(e) {
                        return isoString; // fallback
                    }
                },

                // --- NEW: Helper to format date for <input datetime-local> ---
                formatISODate(isoString) {
                    if (!isoString) return new Date().toISOString().slice(0, 16);
                    try {
                        const dt = new Date(isoString);
                        // Format to 'YYYY-MM-DDTHH:MM'
                        const year = dt.getFullYear();
                        const month = (dt.getMonth() + 1).toString().padStart(2, '0');
                        const day = dt.getDate().toString().padStart(2, '0');
                        const hours = dt.getHours().toString().padStart(2, '0');
                        const minutes = dt.getMinutes().toString().padStart(2, '0');
                        return `${year}-${month}-${day}T${hours}:${minutes}`;
                    } catch(e) {
                        return new Date().toISOString().slice(0, 16); // fallback
                    }
                },

                // Helper to get patient name from ID
                getPatientName(id) {
                    if (!id) return 'Unknown Patient';
                    const patient = this.patients.find(p => p.id === id);
                    return patient ? patient.name : `Patient ID (${id ? id.slice(0,5) : ''}...)`;
                },

                // Helper to get doctor name from ID
                getDoctorName(id) {
                    if (!id) return 'Unknown Doctor';
                    const doctor = this.doctors.find(d => d.id === id);
                    return doctor ? doctor.name : `Doctor ID (${id ? id.slice(0,5) : ''}...)`;
                },
                // --- NEW: Helper to get a doctor's specialty from their ID ---
                getDoctorSpecialty(id) {
                    if (!id) return 'All';
                    const doctor = this.doctors.find(d => d.id === id);
                    return doctor ? doctor.specialty : 'All';
                }
            }
        }
    </script>

    <style>
        /* Simple transition for modal */
        .modal-enter-active, .modal-leave-active {
            transition: opacity 0.2s ease;
        }
        .modal-enter-from, .modal-leave-to {
            opacity: 0;
        }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased" x-data="medicalApp()">

    <!-- Main Container -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg flex flex-col">
            <div class="p-6 border-b border-gray-200">
                <h1 class="text-xl font-bold text-blue-700">Medical System</h1>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <template x-for="tab in tabs" :key="tab.id">
                    <button @click="currentTab = tab.id"
                            :class="currentTab === tab.id ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-100'"
                            class="w-full flex items-center space-x-3 px-4 py-2 rounded-lg transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" x-html="tab.icon"></svg>
                        <span x-text="tab.name"></span>
                    </button>
                </template>
            </nav>
        </div>

        <!-- Content Area -->
        <main class="flex-1 p-8 overflow-y-auto">
            <!-- Loading Spinner -->
            <div x-show="loading" class="flex justify-center items-center h-full">
                <div class="w-16 h-16 border-4 border-blue-500 border-dashed rounded-full animate-spin"></div>
            </div>

            <!-- Main Content (Tabs) -->
            <div x-show="!loading" x-cloak>

                <!-- === DASHBOARD TAB === -->
                <div x-show="currentTab === 'dashboard'">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-6">Dashboard</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Today's Appointments -->
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-700 mb-4">Today's Appointments</h3>
                            <div class="space-y-3 max-h-60 overflow-y-auto">
                                <template x-if="todaysAppointments.length === 0">
                                    <p class="text-sm text-gray-500">No appointments scheduled for today.</p>
                                </template>
                                <template x-for="appt in todaysAppointments" :key="appt.id">
                                    <div class="p-3 bg-blue-50 rounded-lg">
                                        <p class="text-sm font-semibold text-blue-800" x-text="getPatientName(appt.patient)"></p>
                                        <p class="text-sm text-blue-600" x-text="`with ${getDoctorName(appt.doctor)}`"></p>
                                        <p class="text-sm text-gray-600" x-text="formatDateTime(appt.datetime)"></p>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Billing Overview -->
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-700 mb-4">Billing Overview</h3>
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-yellow-100 text-yellow-600 rounded-full">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Pending Bills</p>
                                    <p class="text-2xl font-bold text-gray-800" x-text="pendingBillCount"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Low Stock Items -->
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-700 mb-4">Low Stock Warning</h3>
                            <div class="space-y-3 max-h-60 overflow-y-auto">
                                <template x-if="lowStockItems.length === 0">
                                    <p class="text-sm text-gray-500">Inventory levels look good.</p>
                                </template>
                                <template x-for="item in lowStockItems" :key="item.id">
                                    <div class="p-3 bg-red-50 rounded-lg flex justify-between items-center">
                                        <p class="text-sm font-semibold text-red-800" x-text="item.item"></p>
                                        <p class="text-sm text-red-600 font-bold" x-text="`Stock: ${item.quantity}`"></p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === PATIENTS TAB === -->
                <div x-show="currentTab === 'patients'">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Patient Management</h2>
                        <!-- NEW: Search Bar -->
                        <input type="text" x-model="searchPatient" placeholder="Search by name, contact, or gender..." class="w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button @click="openModal('patients')" class="mb-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition-all">Add Patient</button>
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <!-- MODIFIED: Added Age and Gender -->
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Age</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gender</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">History</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- MODIFIED: Use filteredPatients -->
                                <template x-for="patient in filteredPatients" :key="patient.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="patient.name"></td>
                                        <!-- MODIFIED: Show calculated Age -->
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="calculateAge(patient.dob)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="patient.gender"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="patient.contact"></td>
                                        <td class="px-6 py-4 text-sm text-gray-500 truncate max-w-sm" x-text="patient.history"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                            <button @click="openModal('patients', patient)" class="text-indigo-600 hover:text-indigo-900">Edit</button>
                                            <button @click="deleteItem('patients', patient.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- === DOCTORS TAB === -->
                <div x-show="currentTab === 'doctors'">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Doctor Management</h2>
                        <!-- NEW: Search Bar -->
                        <input type="text" x-model="searchDoctor" placeholder="Search by name or specialty..." class="w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button @click="openModal('doctors')" class="mb-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition-all">Add Doctor</button>
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Specialty</th>
                                    <!-- MODIFIED: Added Fee -->
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Consultation Fee</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Schedule</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- MODIFIED: Use filteredDoctors -->
                                <template x-for="doctor in filteredDoctors" :key="doctor.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="doctor.name"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="doctor.specialty"></td>
                                        <!-- MODIFIED: Show Fee -->
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="doctor.fee ? `₹${doctor.fee.toFixed(2)}` : '₹0.00'"></td>
                                        <td class="px-6 py-4 text-sm text-gray-500" x-text="doctor.schedule"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                            <button @click="openModal('doctors', doctor)" class="text-indigo-600 hover:text-indigo-900">Edit</button>
                                            <button @click="deleteItem('doctors', doctor.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- === APPOINTMENTS TAB === -->
                <div x-show="currentTab === 'appointments'">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Appointment Management</h2>
                        <!-- NEW: Search Bar -->
                        <input type="text" x-model="searchAppointment" placeholder="Search by patient or doctor..." class="w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button @click="openModal('appointments')" class="mb-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition-all">Schedule Appointment</button>
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Doctor</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date/Time</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- MODIFIED: Use filteredAppointments and helper functions -->
                                <template x-for="appt in filteredAppointments" :key="appt.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="getPatientName(appt.patient)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="getDoctorName(appt.doctor)"></td>
                                        <td class="px-6 py-4 text-sm text-gray-500" x-text="formatDateTime(appt.datetime)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                            <button @click="openModal('appointments', appt)" class="text-indigo-600 hover:text-indigo-900">Edit</button>
                                            <button @click="deleteItem('appointments', appt.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- === BILLING TAB === -->
                <div x-show="currentTab === 'billing'">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Billing Management</h2>
                        <!-- NEW: Search Bar -->
                        <input type="text" x-model="searchBilling" placeholder="Search by patient or status..." class="w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button @click="openModal('billing')" class="mb-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition-all">Add Bill</button>
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                                    <!-- MODIFIED: Changed Amount to Total -->
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- MODIFIED: Use filteredBilling and show Total -->
                                <template x-for="bill in filteredBilling" :key="bill.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="getPatientName(bill.patient)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="bill.total ? `₹${bill.total.toFixed(2)}` : '₹0.00'"></td>
                                        <td class="px-6 py-4 text-sm text-gray-500">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                                  :class="{ 'bg-green-100 text-green-800': bill.status === 'Paid', 'bg-yellow-100 text-yellow-800': bill.status === 'Pending', 'bg-red-100 text-red-800': bill.status === 'Overdue' }"
                                                  x-text="bill.status"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                            <!-- NEW: "Mark as Paid" and "View Items" buttons -->
                                            <button @click="showBillItems(bill)" class="text-blue-600 hover:text-blue-900">View Items</button>
                                            <button x-show="bill.status !== 'Paid'" @click="markAsPaid(bill.id)" class="text-green-600 hover:text-green-900">Mark as Paid</button>
                                            <button @click="openModal('billing', bill)" class="text-indigo-600 hover:text-indigo-900">Edit</button>
                                            <button @click="deleteItem('billing', bill.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- === INVENTORY TAB === -->
                <div x-show="currentTab === 'inventory'">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Inventory Management</h2>
                        <!-- NEW: Search Bar -->
                        <input type="text" x-model="searchInventory" placeholder="Search by item or supplier..." class="w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button @click="openModal('inventory')" class="mb-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition-all">Add Item</button>
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                                    <!-- MODIFIED: Added Price column -->
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Supplier</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <!-- MODIFIED: Use filteredInventory and show Price -->
                                <template x-for="item in filteredInventory" :key="item.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="item.item"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.price ? `₹${item.price.toFixed(2)}` : '₹0.00'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="item.quantity"></td>
                                        <td class="px-6 py-4 text-sm text-gray-500" x-text="item.supplier"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                            <button @click="openModal('inventory', item)" class="text-indigo-600 hover:text-indigo-900">Edit</button>
                                            <button @click="deleteItem('inventory', item.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- === ADD/EDIT MODAL === -->
    <div x-show="modal.open"
         class="fixed inset-0 z-10 overflow-y-auto"
         x-transition:enter="modal-enter-active"
         x-transition:leave="modal-leave-active"
         x-cloak>
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div x-show="modal.open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 class="fixed inset-0 transition-opacity"
                 @click="modal.open = false">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <!-- Modal panel -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen"></span>&#8203;
            <div x-show="modal.open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">

                <form @submit.prevent="submitForm()">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" x-text="modal.title"></h3>
                        <div class="mt-4 space-y-4">
                            <!-- Patient Fields -->
                            <template x-if="modal.type === 'patients'">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Name</label>
                                        <input type="text" x-model="form.name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <!-- MODIFIED: Age to DOB (date input) -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
                                        <input type="date" x-model="form.dob" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <!-- MODIFIED: Added Gender dropdown -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Gender</label>
                                        <select x-model="form.gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                            <option value="M">Male</option>
                                            <option value="F">Female</option>
                                            <option value="O">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Contact</label>
                                        <input type="text" x-model="form.contact" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Medical History</label>
                                        <textarea x-model="form.history" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
                                    </div>
                                </div>
                            </template>

                            <!-- Doctor Fields -->
                            <template x-if="modal.type === 'doctors'">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Name</label>
                                        <input type="text" x-model="form.name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <!-- MODIFIED: Changed Specialty to a dropdown -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Specialty</label>
                                        <select x-model="form.specialty" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                            <template x-for="spec in doctorSpecialties" :key="spec">
                                                <option :value="spec" x-text="spec"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <!-- NEW: Added Consultation Fee -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Consultation Fee (₹)</label>
                                        <input type="number" step="1" min="0" x-model.number="form.fee" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Schedule</label>
                                        <input type="text" x-model="form.schedule" placeholder="e.g., Mon, Wed, Fri 9AM-5PM" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                    </div>
                                </div>
                            </template>

                            <!-- Appointment Fields -->
                            <template x-if="modal.type === 'appointments'">
                                <div class="space-y-4">
                                    <!-- MODIFIED: Dropdown for Patient -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Patient</label>
                                        <!-- FIX: value="" on disabled option, default form.patient to '' -->
                                        <select x-model="form.patient" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                            <option value="" disabled>Select a patient</option>
                                            <template x-for="p in patients" :key="p.id">
                                                <option :value="p.id" x-text="p.name"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <!-- --- NEW: Specialty Filter Dropdown --- -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Filter by Specialty</label>
                                        <select x-model="appointmentSpecialty" @change="form.doctor = ''" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                            <option value="All">All Specialties</option>
                                            <template x-for="spec in doctorSpecialties" :key="spec">
                                                <option :value="spec" x-text="spec"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <!-- --- MODIFIED: Doctor dropdown now filters based on specialty --- -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Doctor</label>
                                        <!-- FIX: value="" on disabled option, default form.doctor to '' -->
                                        <select x-model="form.doctor" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required :disabled="filteredDoctorsForAppointment.length === 0">
                                            <option value="" disabled>Select a doctor</option>
                                            <template x-for="d in filteredDoctorsForAppointment" :key="d.id">
                                                <option :value="d.id" x-text="`${d.name} (${d.specialty})`"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Date & Time</label>
                                        <input type="datetime-local" x-model="form.datetime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                </div>
                            </template>

                            <!-- Billing Fields (MODIFIED) -->
                            <template x-if="modal.type === 'billing'">
                                <div class="space-y-4">
                                    <!-- Patient Dropdown -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Patient</label>
                                        <!-- FIX: value="" on disabled option, default form.patient to '' -->
                                        <select x-model="form.patient" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                            <option value="" disabled>Select a patient</option>
                                            <template x-for="p in patients" :key="p.id">
                                                <option :value="p.id" x-text="p.name"></option>
                                            </template>
                                        </select>
                                    </div>

                                    <!-- Add Item Form -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Add Items to Bill</label>
                                        <div class="flex space-x-2 mt-1">
                                            <select x-model="billForm.itemId" class="block w-2/3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                                <option value="" disabled>Select an item...</option>
                                                <template x-for="i in inventory" :key="i.id">
                                                    <option :value="i.id" x-text="`${i.item} - ₹${i.price.toFixed(2)} (Stock: ${i.quantity})`"></option>
                                                </template>
                                            </select>
                                            <input type="number" x-model.number="billForm.quantity" min="1" class="block w-1/4 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Qty">
                                            <button type="button" @click="addItemToBill()" class="px-3 py-2 bg-blue-500 text-white rounded-md shadow-sm hover:bg-blue-600 text-sm">+</button>
                                        </div>
                                    </div>

                                    <!-- Item List -->
                                    <div class="max-h-32 overflow-y-auto space-y-2 pr-2">
                                        <template x-for="item in form.items" :key="item.id">
                                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-900" x-text="item.name"></p>
                                                    <p class="text-sm text-gray-500" x-text="`${item.quantity} x ₹${item.price.toFixed(2)} = ₹${(item.quantity * item.price).toFixed(2)}`"></p>
                                                </div>
                                                <button type="button" @click="removeItemFromBill(item.id)" class="text-red-500 hover:text-red-700">&times;</button>
                                            </div>
                                        </template>
                                    </div>

                                    <!-- Bill Total and Status -->
                                    <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                                        <h4 class="text-lg font-bold">Total: ₹<span x-text="form.total.toFixed(2)"></span></h4>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Status</label>
                                            <select x-model="form.status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                                <option>Pending</option>
                                                <option>Paid</option>
                                                <option>Overdue</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Inventory Fields -->
                            <template x-if="modal.type === 'inventory'">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Item Name</label>
                                        <input type="text" x-model="form.item" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <!-- MODIFIED: Added Price -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Price (₹)</label>
                                        <input type="number" step="0.01" min="0" x-model.number="form.price" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Quantity</Vlabel>
                                        <input type="number" step="1" min="0" x-model.number="form.quantity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Supplier</label>
                                        <input type="text" x-model="form.supplier" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                    </div>
                                </div>
                            </template>

                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit"
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm"
                                x-text="modal.isEdit ? 'Update' : 'Save'"></button>
                        <button type="button"
                                @click="modal.open = false"
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- === VIEW BILL ITEMS MODAL === -->
    <div x-show="billModal.open"
         class="fixed inset-0 z-20 overflow-y-auto"
         x-transition:enter="modal-enter-active"
         x-transition:leave="modal-leave-active"
         x-cloak>
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div x-show="billModal.open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 class="fixed inset-0 transition-opacity"
                 @click="billModal.open = false">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <!-- Modal panel -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen"></span>&#8203;
            <div x-show="billModal.open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">

                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Bill Details</h3>
                    <div class="mt-4 space-y-2 max-h-60 overflow-y-auto">
                        <template x-for="item in billModal.items" :key="item.id">
                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                <div>
                                    <p class="text-sm font-medium text-gray-900" x-text="item.name"></p>
                                    <p class="text-sm text-gray-500" x-text="`${item.quantity} x ₹${item.price.toFixed(2)} = ₹${(item.quantity * item.price).toFixed(2)}`"></p>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="flex justify-end items-center pt-4 border-t border-gray-200 mt-4">
                        <h4 class="text-lg font-bold">Total: ₹<span x-text="billModal.total.toFixed(2)"></span></h4>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button"
                            @click="billModal.open = false"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>

